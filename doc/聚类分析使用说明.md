# 用水行为聚类分析 - 页面功能使用说明

## 一、菜单入口

在若依后台管理系统的左侧菜单中：

```
用水管理
├── 住户管理
├── 用水记录
├── 聚类分析    ← 本功能
└── 异常记录    ← 本功能
```

---

## 二、聚类分析页面

### 2.1 页面布局

```
┌─────────────────────────────────────────────────────────┐
│  用水行为聚类分析                                         │
│  ┌─────────┐ ┌─────────┐ ┌────────┐ ┌────────┐ ┌────┐   │
│  │统计周期 │ │聚类数K  │ │一键分析│ │执行聚类│ │配置│   │
│  └─────────┘ └─────────┘ └────────┘ └────────┘ └────┘   │
├─────────────────────────────────────────────────────────┤
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐               │
│  │节约型 │ │正常型 │ │高耗型 │ │ ...   │  ← 统计卡片    │
│  │ 5人   │ │ 12人  │ │ 3人   │ │       │               │
│  └───────┘ └───────┘ └───────┘ └───────┘               │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐              │
│  │   聚类分布饼图   │  │  特征对比雷达图  │  ← 可视化图表 │
│  │                 │  │                 │              │
│  └─────────────────┘  └─────────────────┘              │
├─────────────────────────────────────────────────────────┤
│  聚类结果明细                          [筛选簇▼] [查询]  │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 用户ID │ 用户名 │ 日均用水 │ 凌晨占比 │ 聚类标签 │   │
│  ├────────┼────────┼──────────┼──────────┼──────────┤   │
│  │   1    │ 张三   │   0.25   │   5%     │  正常型  │   │
│  │   2    │ 李四   │   0.12   │   2%     │  节约型  │   │
│  │  ...   │  ...   │   ...    │   ...    │   ...    │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 2.2 操作步骤

#### 步骤1：选择统计周期

点击"统计周期"日期选择器，选择要分析的月份（如：2024-12）

#### 步骤2：设置聚类数量

调整"聚类数(K)"的值：
- **K=3**（推荐）：将用户分为节约型、正常型、高耗型
- **K=2**：将用户分为两类
- **K=4+**：更细粒度的分类

#### 步骤3：执行分析

| 按钮 | 功能 | 使用场景 |
|------|------|----------|
| **一键分析** | 生成特征 + 聚类 + 异常检测 | 首次分析或完整分析 |
| **执行聚类** | 仅执行K-Means聚类 | 已有特征数据，只想重新聚类 |
| **异常检测** | 仅执行异常检测 | 只想检测异常，不重新聚类 |

#### 步骤4：查看结果

- **统计卡片**：显示每个聚类的用户数量和平均日用水量
- **饼图**：直观展示各聚类的用户占比
- **雷达图**：对比各聚类的特征差异
- **明细表格**：查看每个用户的具体特征和聚类标签

### 2.3 算法配置

点击"算法配置"按钮，可调整以下参数：

| 参数 | 说明 | 建议值 |
|------|------|--------|
| 聚类数量(K) | 分几类 | 3 |
| 最大迭代次数 | 算法最多迭代多少次 | 100 |
| 收敛阈值 | 质心变化小于多少时停止 | 0.0001 |
| 数据标准化 | 是否对数据进行标准化处理 | 开启 |
| 聚类标签 | 每个簇的名称 | 节约型、正常型、高耗型 |

---

## 三、异常记录页面

### 3.1 页面布局

```
┌─────────────────────────────────────────────────────────┐
│  ┌────────┐ ┌────────┐ ┌──────────┐ ┌────────┐         │
│  │用户ID  │ │统计周期│ │异常类型▼ │ │处理状态│ [搜索]  │
│  └────────┘ └────────┘ └──────────┘ └────────┘         │
├─────────────────────────────────────────────────────────┤
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐               │
│  │异常总数│ │待处理 │ │已处理 │ │已忽略 │  ← 统计概览    │
│  │  20   │ │  8    │ │  10   │ │  2    │               │
│  └───────┘ └───────┘ └───────┘ └───────┘               │
├─────────────────────────────────────────────────────────┤
│  [规则配置] [刷新列表]                                   │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ID │ 用户 │ 异常类型 │ 异常值 │ 阈值 │ 状态 │ 操作 │   │
│  ├────┼──────┼──────────┼────────┼──────┼──────┼──────┤   │
│  │ 1  │ 王五 │凌晨用水异常│ 18.5% │ 15%  │待处理│处理  │   │
│  │ 2  │ 赵六 │日均用水异常│ 0.68  │ 0.5  │已处理│详情  │   │
│  │... │ ...  │   ...    │  ...   │ ...  │ ...  │ ...  │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 3.2 异常类型说明

| 异常类型 | 含义 | 触发条件 |
|----------|------|----------|
| 凌晨用水异常 | 凌晨(0-6点)用水占比过高 | 占比 > 15% |
| 日均用水异常 | 日均用水量过高 | 日均 > 0.5 m³ |
| 周末用水异常 | 周末用水占比过高 | 占比 > 40% |

### 3.3 处理状态

| 状态 | 说明 | 颜色 |
|------|------|------|
| 待处理 | 新检测到的异常，等待处理 | 黄色 |
| 已处理 | 已确认并处理的异常 | 绿色 |
| 已忽略 | 已确认为误报或无需处理 | 灰色 |

### 3.4 操作说明

#### 处理异常

1. 在列表中找到"待处理"的异常记录
2. 点击"处理"按钮
3. 填写处理意见（可选）
4. 点击"确定"

#### 忽略异常

1. 点击"忽略"按钮
2. 填写忽略原因（可选）
3. 点击"确定"

#### 查看详情

点击"详情"按钮，查看异常的完整信息。

### 3.5 规则配置

点击"规则配置"按钮，可以：

- **查看规则**：查看当前所有异常检测规则
- **编辑规则**：修改规则的阈值参数
- **删除规则**：移除不需要的规则
- **添加规则**：创建新的异常检测规则

---

## 四、使用流程建议

### 4.1 日常分析流程

```
每月初执行：
1. 进入"聚类分析"页面
2. 选择上个月的统计周期
3. 点击"一键分析"
4. 查看聚类结果，了解用户用水行为分布
5. 进入"异常记录"页面
6. 处理检测到的异常记录
```

### 4.2 异常处理流程

```
发现异常后：
1. 查看异常详情，了解异常类型和数值
2. 联系用户核实情况
3. 根据核实结果：
   - 确实存在问题 → 点击"处理"，记录处理措施
   - 误报或正常情况 → 点击"忽略"，记录原因
```

---

## 五、常见问题

### Q1: 为什么点击"一键分析"后没有数据？

**原因**：该月份没有用水记录数据

**解决**：
1. 确认普通用户已录入该月的用水记录
2. 选择有数据的月份重新分析

### Q2: 聚类结果不合理怎么办？

**解决**：
1. 调整K值，尝试不同的聚类数量
2. 在"算法配置"中调整参数
3. 确保有足够的用户数据（建议至少10个以上用户）

### Q3: 异常检测阈值如何设置？

**建议**：
1. 根据实际业务情况调整
2. 初期可设置较宽松的阈值，逐步收紧
3. 参考历史数据的统计分布

### Q4: 如何添加新的异常检测规则？

**步骤**：
1. 进入"异常记录"页面
2. 点击"规则配置"
3. 点击"添加规则"
4. 填写规则编码、名称、描述和阈值
5. 点击"确定"

---

## 六、注意事项

1. **数据量要求**：建议至少有10个以上用户的数据才能获得有意义的聚类结果
2. **周期选择**：选择数据完整的月份进行分析
3. **及时处理**：定期查看和处理异常记录
4. **规则调优**：根据实际情况调整异常检测规则的阈值

